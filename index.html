
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>√âtude photovolta√Øque</title>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAPz59eSA-UkT2AzlQzXslwzt8V5uftFzM&libraries=places"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body { font-family: Arial; padding: 20px; background: #f7f9fc; }
    h1 { background: #5cb85c; color: white; padding: 10px; text-align: center; border-radius: 5px; }
    .identite, form { background: #fff; border-radius: 6px; padding: 15px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); margin-bottom: 20px; }
    .identite { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; }
    label { font-weight: bold; display: block; margin-bottom: 5px; }
    input, select { width: 100%; padding: 8px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 4px; }
    .full-width { grid-column: span 2; display: flex; gap: 15px; justify-content: flex-start; margin-top: 10px; }
    .recap { background: #fff3cd; padding: 15px; border: 1px solid #ffeeba; border-radius: 6px; font-size: 0.95rem; color: #856404; white-space: pre-line; margin: 20px 0; }
    button { padding: 10px 20px; margin-right: 10px; background: #28a745; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 16px; }
    button:hover { background: #218838; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; background: #fff; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background: #007bff; color: white; }
    .label { background: #eef3f9; font-weight: bold; text-align: left; padding-left: 10px; }
  </style>
</head>
<body>

<h1>Votre √©tude photovolta√Øque personnalis√©e</h1>

<div class="identite">
  <div><label>Nom / Pr√©nom</label><input type="text" id="nom"></div>
  <div><label>Adresse</label><input type="text" id="adresse"></div>
  <div><label>Code postal + Ville</label><input type="text" id="cpville"></div>
  <div><label>T√©l√©phone</label><input type="text" id="tel"></div>
  <div><label>Email</label><input type="email" id="email"></div>
  <div><label>Point de livraison (PDL)</label><input type="text" id="pdl"></div>
</div>

<form>
  <div><label>Consommation annuelle (kWh)</label><input type="number" id="conso" value="9800"></div>
  <div><label>Prix du kWh (‚Ç¨)</label><input type="number" id="prixKwh" value="0.200" step="0.001"></div>
  <div><label>Production photovolta√Øque (kWh/an)</label><input type="number" id="prod" value="6200"></div>
  <div><label>% Autoconsommation</label><input type="number" id="autoconso" value="40"></div>
  <div><label>Co√ªt d'acheminement stockage (‚Ç¨ / kWh)</label><input type="number" id="acheminement" value="0.05" step="0.001"></div>
  <div><label>Taux d‚Äôaugmentation du kWh / an (%)</label><input type="number" id="taux" value="5" step="0.1"></div>
  <div class="full-width">
    <button type="button" onclick="genererSimulation()">üìä G√©n√©rer le tableau</button>
    <button type="button" onclick="exporterPDF()">üìÑ Exporter la bo√Æte jaune en PDF</button>
  </div>
</form>

<div class="recap" id="recapSimulation">Simulation en attente de g√©n√©ration.</div>

<div id="resultatSimulation"></div>

<script>
  function genererSimulation() {
    const conso = parseFloat(document.getElementById('conso').value);
    const prixKwh = parseFloat(document.getElementById('prixKwh').value);
    const prod = parseFloat(document.getElementById('prod').value);
    const autoPct = parseFloat(document.getElementById('autoconso').value);
    const acheminement = parseFloat(document.getElementById('acheminement').value);
    const taux = parseFloat(document.getElementById('taux').value) / 100;

    const autoKwh = prod * autoPct / 100;
    const stockKwh = prod - autoKwh;
    const facture = conso * prixKwh;

    document.getElementById('recapSimulation').innerText =
      `Consommation annuelle : ${conso} kWh
` +
      `Prix du kWh : ${prixKwh.toFixed(3)} ‚Ç¨
` +
      `Facture annuelle (hors abonnement et taxes) : ${facture.toFixed(0)} ‚Ç¨
` +
      `Production annuelle : ${prod} kWh
` +
      `En autoconsommation : ${autoKwh.toFixed(0)} kWh (${autoPct.toFixed(0)} %)
` +
      `Surplus : ${stockKwh.toFixed(0)} kWh (${(100 - autoPct).toFixed(0)} %)`;


    let table = '<table><thead><tr><th>Ann√©e</th>';
    for (let i = 1; i <= 15; i++) table += `<th>${i}</th>`;
    table += '</tr></thead><tbody>';

    const rows = [
      { label: `Prix du kWh`, values: [] },
      { label: `Conso actuelle (${conso} kWh)`, values: [] },
      { label: `Autoconsommation (${autoKwh.toFixed(0)} kWh)`, values: [] },
      { label: `Stockage virtuel (${stockKwh.toFixed(0)} kWh)`, values: [] },
      { label: `Acheminement stockage (${acheminement.toFixed(2)} ‚Ç¨/kWh)`, values: [] },
      { label: `Nouvelle facture`, values: [] },
      { label: `√âconomie annuelle`, values: [] },
      { label: `√âconomie mensuelle`, values: [] },
    ];

    let totalEconomie = 0;

    for (let i = 0; i < 15; i++) {
      const prixAn = prixKwh * Math.pow(1 + taux, i);
      const factureAvant = conso * prixAn;
      const autoValue = autoKwh * prixAn;
      const stockValue = stockKwh * prixAn;
      const acheminementCost = stockKwh * acheminement;
      const factureApres = factureAvant - autoValue - stockValue + acheminementCost;
      const economie = factureAvant - factureApres;

      rows[0].values.push(prixAn.toFixed(3) + ' ‚Ç¨');
      rows[1].values.push(factureAvant.toFixed(0) + ' ‚Ç¨');
      rows[2].values.push('-' + autoValue.toFixed(0) + ' ‚Ç¨');
      rows[3].values.push('-' + stockValue.toFixed(0) + ' ‚Ç¨');
      rows[4].values.push('+' + acheminementCost.toFixed(0) + ' ‚Ç¨');
      rows[5].values.push(factureApres.toFixed(0) + ' ‚Ç¨');
      rows[6].values.push(economie.toFixed(0) + ' ‚Ç¨');
      rows[7].values.push(Math.round(economie / 12) + ' ‚Ç¨');
      totalEconomie += economie;
    }

    rows.forEach(row => {
      table += `<tr><td class="label">${row.label}</td>`;
      row.values.forEach(val => table += `<td>${val}</td>`);
      table += '</tr>';
    });

    table += `</tbody></table><p style="font-weight:bold; margin-top:15px;">√âconomie totale sur 15 ans : ${totalEconomie.toFixed(0)} ‚Ç¨</p>`;

    document.getElementById('resultatSimulation').innerHTML = table;
  }

  async function exporterPDF() {
    const recapText = document.getElementById('recapSimulation').innerText;
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    doc.setFontSize(12);
    doc.text(recapText, 10, 10);
    doc.save("etude_photovoltaique.pdf");
  }

  window.addEventListener('load', function () {
    const adresseInput = document.getElementById('adresse');
    const cpVilleInput = document.getElementById('cpville');

    if (adresseInput) {
      const autocomplete = new google.maps.places.Autocomplete(adresseInput, {
        types: ['geocode'],
        componentRestrictions: { country: 'fr' }
      });

      autocomplete.addListener('place_changed', function () {
        const place = autocomplete.getPlace();
        let rue = '', numero = '', cp = '', ville = '';

        if (place.address_components) {
          place.address_components.forEach(function (component) {
            const types = component.types;
            if (types.includes('street_number')) numero = component.long_name;
            if (types.includes('route')) rue = component.long_name;
            if (types.includes('postal_code')) cp = component.long_name;
            if (types.includes('locality')) ville = component.long_name;
          });

          adresseInput.value = `${numero} ${rue}`.trim();
          cpVilleInput.value = `${cp} ${ville}`.trim();
        }
      });
    }
  });
</script>

</body>
</html>
